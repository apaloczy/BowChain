#+TITLE: BowChain
#+AUTHOR: Dylan Winters

* Overview
Process a bow chain dataset using ~BowChain_master(cruiseName,deploymentName)~.

* Configuration

** Cruise- and deployment-specific configuration

Within the [[file:Code/][Code]] directory, cruise-specific folders contain information needed to
locate and process deployments. Each cruise needs a configuration file in its
corresponding folder.

For example, [[file:Code/Cruise_ArcticMix/config_ArcticMix.m][Cruse_ArcticMix/config_ArcticMix.m]] contains information about bow
chain deployments on the ArcticMix cruise. Within the configuration file is a
switch statement that sets processing options depending on the given deployment
name:

#+BEGIN_SRC matlab
%% Deployment-specific options
switch dep
  case 'MooringToIce'
    config.dir_deployment = '11sept_1900_recovery';
    config.dn_range = datenum([...
        '09-Sep-2015 21:49:40';
        '10-Sep-2015 08:36:14']);
    config.sensor_sn ={'00451';'100161';'100154';'060281';'00407';'100160';...
                       '100153';'00445';'100157';'00422';'100159';'100158';'00442';...
                       '100162';'03253';'100155';'00392';'00372';'060280';'100156'};
    config.sensor_pos = [0 1 2 3 4 5 6 7 8 9 11 12 13 14 14.5 15 16 17 18 19];
end
#+END_SRC

For now, only the "MooringToIce" deployment is configured.


** Required configuration options 

| Option           | Description                                                                    |
|------------------+--------------------------------------------------------------------------------|
| ~freq_base~      | The frequency of the output gridded data                                       |
| ~dir_raw~        | The full path to the base directory containing raw data                        |
| ~dir_deployment~ | The subdirectory within ~dir_raw~ containing data logged during the deployment |
| ~dn_range~       | A range of datenums for the deployment start and end times                     |
| ~sensor_sn~      | A cell array of sensor serial numbers (as strings)                             |
| ~sensor_pos~     | Nominal positions of sensors along the chain                                   |
| ~chain_model~    | The model used to accout for the bow chain's shape                             |

An error will be thrown before processing begins if any of these options have
not been specified.

** Setting configuration options

Configuration options are first loaded from [[file:Code/config_default.m][config_default.m]]. Currently, this
only sets a default base frequency and chain model name:

#+BEGIN_SRC matlab
% config_default.m
config.freq_base = 2;
config.chain_model = 'cm_straight';
#+END_SRC

Deployment-specific options are set as shown above for the "MooringToIce"
deployment. Any options defined prior to the deployment name switch will be
overwritten by deployment-specific configuration.

The order in which options are read results in the following priority (higher
priorities overwrite lower priorities):

1. Cruise-wide options defined after the deployment name switch
2. Deployment-specific options defined in the deployment name switch
3. Cruise-wide options defined prior to the deployment name switch
4. Default options defined in [[file:Code/config_default.m][config_default.m]]


* Chain Shape models

** cm_straight.m

This model requires 2 assumptions:

1. Instruments only move vertically, as if they're attached to a spring on a pole.
2. Features (e.g. changes in temperature) are vertically uniform (background
   levels do not need to be uniform).

These assumptions are equivalent to assuming that /all/ apparent time offsets in
sensor signals are due to clock differences.

The figure below illustrates the differences between an actual temperature field
and what is measured by a chain of sensors with random time offsets. Shifting
sensor signals in time to maximize correlation between signals from adjacent
sensors (not shown in figure) allows for reconstruction of the actual
temperature field.

[[Figures/chain_models/cm_straight.gif]]

/Note that in the absence of vertical sensor motion, x-offsets in instrument position result in apparent time offsets under this model and can handled using the same method./
